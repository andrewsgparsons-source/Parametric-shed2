<!-- FILE: docs/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Parametric Shed — Views</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#f0f2f5; --shadow: 0 4px 14px rgba(0,0,0,0.18); }

    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: #000;
      overflow: hidden;
    }

    #renderCanvas{
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      outline: none;
      display: block;
      background: transparent;
      touch-action: none;
    }

    #topbar{
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 2147483000;
      display: flex;
      gap: 8px;
      align-items: center;
      pointer-events: auto;
    }
    #viewSelect{
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      border: none;
      box-shadow: var(--shadow);
      font-weight: 700;
      background: #fff;
    }

    #ui-layer{
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 2147480000;
      display: none;
    }

    #controls{
      position: fixed;
      top: 16px;
      left: 16px;
      z-index: 2147482500;
      pointer-events: auto;
      max-width: min(420px, calc(100vw - 32px));
    }

    /* Controls visible ONLY in 3D */
    body[data-view="base"]  #controls,
    body[data-view="walls"] #controls { display:none !important; }
    body[data-view="3d"] #controls { display:block; }

    #controlPanel details{
      background: #fff;
      border-radius: 10px;
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    #controlPanel summary{
      list-style: none;
      cursor: pointer;
      padding: 10px 12px;
      font-weight: 800;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      user-select: none;
      outline: none;
    }
    #controlPanel summary::-webkit-details-marker{ display:none; }
    #controlPanel .inner{
      padding: 10px 12px 12px 12px;
      max-height: min(70vh, 560px);
      overflow: auto;
    }
    #controlPanel form{ display:grid; gap:10px; margin:0; }
    #controlPanel fieldset{
      border: 1px solid #e7e7e7;
      border-radius: 10px;
      padding: 10px;
      margin: 0;
      min-width: 0;
    }
    #controlPanel legend{
      padding: 0 6px;
      font-size: 12px;
      font-weight: 900;
      color: #222;
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }
    #controlPanel .row{ display:grid; grid-template-columns:1fr 1fr; gap:8px; align-items:center; }
    #controlPanel .row3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; align-items:center; }
    #controlPanel .row4{ display:grid; grid-template-columns:1fr 1fr; gap:8px; align-items:center; }
    #controlPanel label{ display:grid; gap:4px; font-size:12px; color:#222; }
    #controlPanel input[type="number"], #controlPanel input[type="text"], #controlPanel select{
      width:100%;
      padding: 8px 10px;
      border: 1px solid #d9d9d9;
      border-radius: 8px;
      font-size: 13px;
      background: #fff;
      box-sizing: border-box;
    }
    #controlPanel .checks{ display:grid; grid-template-columns:1fr 1fr; gap:6px 10px; margin-top:4px; }
    #controlPanel .check{ display:flex; gap:8px; align-items:center; font-size:13px; color:#222; }
    #controlPanel .hint{ font-size:11px; color:#666; margin:6px 0 0 0; }

    #controlPanel button{
      padding: 8px 10px;
      border: 1px solid #d9d9d9;
      border-radius: 8px;
      background: #fff;
      cursor: pointer;
      font-size: 13px;
      font-weight: 700;
    }
    #controlPanel button:disabled{ opacity: 0.5; cursor: not-allowed; }

    .doorItem, .windowItem{
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 10px;
      display: grid;
      gap: 8px;
      background: #fafafa;
    }
    .doorTop, .windowTop{
      display:flex;
      gap:8px;
      align-items:flex-end;
      justify-content:space-between;
    }
    .doorActions, .windowActions{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:flex-end;
    }
    .doorMsg, .windowMsg{
      font-size: 12px;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #f0c5c5;
      background: #ffecec;
      color: #7a1a1a;
      display: none;
      white-space: pre-wrap;
    }
    .doorMsg.show, .windowMsg.show{ display:block; }
    .snapBtn{ display:none; }
    .snapBtn.show{ display:inline-block; }

    .page{
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      background: var(--bg);
      display: none;
      overflow: auto;
      padding: 80px 24px 24px;
      box-sizing: border-box;
      z-index: 1000;
    }
    .schedule-section{ margin-bottom: 30px; }
    h2{ margin: 0 0 20px 0; text-align:center; }
    h4{
      background:#333;
      color:#fff;
      padding:10px;
      margin:0;
      border-radius:4px 4px 0 0;
      font-size:14px;
      text-transform:uppercase;
    }
    table{
      width:100%;
      border-collapse:collapse;
      background:#fff;
      margin-bottom:10px;
      box-shadow:0 2px 8px rgba(0,0,0,0.05);
    }
    th, td{ padding:12px; text-align:left; border-bottom:1px solid #eee; font-size:13px; }
    th{ background:#f8f9fa; color:#555; }
    .sticky-table thead th{ position:sticky; top:80px; z-index:1; }
    .totals-row td{ font-weight:bold; }
    .subtle{ color:#666; font-size:12px; margin:6px 0 12px 0; }

    #bomToolbar{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:flex-end;
      margin:8px 0 16px 0;
    }
    #bomToolbar select, #bomToolbar button{
      padding:6px 10px;
      border:1px solid #ddd;
      border-radius:6px;
      background:#fff;
      cursor:pointer;
    }

    #statusOverlay{
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2147483000;
      background: rgba(0,0,0,0.75);
      color: #fff;
      padding: 8px 10px;
      border-radius: 8px;
      font: 12px/1.3 monospace;
      max-width: 95vw;
      white-space: pre-wrap;
      pointer-events: none;
      display: none;
    }

    @media print{
      #topbar, #renderCanvas, #statusOverlay, #controls { display:none !important; }
      body, html { overflow: visible !important; height:auto !important; background:#fff !important; }
      .page{
        padding: 0 10mm !important;
        box-shadow:none !important;
        background:#fff !important;
        display:block !important;
        position:static !important;
        height:auto !important;
      }
      #bomToolbar{ display:none !important; }
      .sticky-table thead th{ top:0; }
    }
  </style>
</head>

<body data-view="3d">
  <canvas id="renderCanvas" tabindex="0" aria-hidden="false"></canvas>
  <div id="statusOverlay">status...</div>

  <div id="topbar">
    <select id="viewSelect" aria-label="Select view">
      <option value="3d" selected>3D Scene View</option>
      <option value="walls">Walls Cutting List</option>
      <option value="base">Base Cutting List</option>
      <option value="roof">Roof Cutting List</option>
    </select>
  </div>

  <div id="ui-layer" aria-hidden="true"></div>

  <div id="controls" aria-label="Controls">
    <aside id="controlPanel" aria-label="Controls panel">
      <details open>
        <summary>Controls <span style="font-weight:700;font-size:12px;color:#666;">(toggle)</span></summary>
        <div class="inner">
          <form aria-label="Shed controls">
            <fieldset>
              <legend>Visibility</legend>
              <div class="checks" role="group" aria-label="Visibility toggles">
                <label class="check"><input id="vWalls" type="checkbox" checked /> Walls</label>
                <label class="check"><input id="vBase" type="checkbox" checked /> Base Grid</label>
                <label class="check"><input id="vFrame" type="checkbox" checked /> Timber Frame</label>
                <label class="check"><input id="vIns" type="checkbox" checked /> Insulation</label>
                <label class="check"><input id="vDeck" type="checkbox" checked /> Decking</label>
              </div>
              <p class="hint">Shortcuts: 1=3D, 2=Walls, 3=Base (when not typing).</p>
            </fieldset>

            <fieldset>
              <legend>Walls</legend>

              <div class="row">
                <label>
                  Stud/Plate Size
                  <select id="wallSection" aria-label="Stud and plate size">
                    <option value="50x75">50×75</option>
                    <option value="50x100" selected>50×100</option>
                  </select>
                </label>
                <label>
                  Variant
                  <select id="wallsVariant">
                    <option value="insulated" selected>insulated</option>
                    <option value="basic">basic</option>
                  </select>
                </label>
              </div>

              <div class="row">
                <label>
                  Height (mm)
                  <input id="wallHeight" type="number" min="100" step="10" value="2400" />
                </label>
                <div></div>
              </div>

              <div class="checks" role="group" aria-label="Wall parts">
                <label class="check"><input id="vWallFront" type="checkbox" checked /> Front</label>
                <label class="check"><input id="vWallBack" type="checkbox" checked /> Back</label>
                <label class="check"><input id="vWallLeft" type="checkbox" checked /> Left</label>
                <label class="check"><input id="vWallRight" type="checkbox" checked /> Right</label>
              </div>
            </fieldset>

            <fieldset>
              <legend>Doors</legend>
              <div class="row">
                <button id="addDoorBtn" type="button">Add Door</button>
                <button id="removeAllDoorsBtn" type="button">Remove All Doors</button>
              </div>
              <div id="doorsList"></div>
              <p class="hint">Commit edits on Enter or click-away. Invalid doors highlight red; use the snap button to resolve.</p>
            </fieldset>

            <fieldset>
              <legend>Windows</legend>
              <div class="row">
                <button id="addWindowBtn" type="button">Add Window</button>
                <button id="removeAllWindowsBtn" type="button">Remove All Windows</button>
              </div>
              <div id="windowsList"></div>
              <p class="hint">Window Y is measured from the bottom plate top (inside the frame). Invalid windows highlight red; snap resolves X-only.</p>
            </fieldset>

            <fieldset>
              <legend>Dimensions</legend>
              <div class="row">
                <label>
                  Mode
                  <select id="dimMode">
                    <option value="base" selected>base</option>
                    <option value="frame">frame</option>
                    <option value="roof">roof</option>
                  </select>
                </label>
                <div></div>
              </div>

              <div class="row">
                <label>
                  Width (mm) — X direction
                  <input id="wInput" type="number" min="1" step="10" value="3000" />
                </label>
                <label>
                  Depth (mm) — Z direction
                  <input id="dInput" type="number" min="1" step="10" value="4000" />
                </label>
              </div>
              <p class="hint">
                Tip: swapping Width/Depth changes the decking layout (by design). Orientation still auto-flips based on the dimensions.
              </p>
            </fieldset>

            <fieldset>
              <legend>Roof Overhang (mm)</legend>
              <div class="row">
                <label>
                  Roof Style
                  <select id="roofStyle">
                    <option value="apex" selected>Apex (gabled)</option>
                    <option value="pent">Pent (single pitch)</option>
                    <option value="hipped">Hipped</option>
                  </select>
                </label>
                <div></div>
              </div>

              <div class="row">
                <label>
                  Min Height (mm)
                  <input id="roofMinHeight" type="number" min="100" step="10" value="2400" />
                </label>
                <label>
                  Max Height (mm)
                  <input id="roofMaxHeight" type="number" min="100" step="10" value="2400" />
                </label>
              </div>

              <div class="row">
                <label>Uniform<input id="roofOverUniform" type="number" min="0" step="1" value="0" /></label>
                <div></div>
              </div>
              <div class="row">
                <label>Front<input id="roofOverFront" type="number" min="0" step="1" placeholder="(blank = uniform)" /></label>
                <label>Back<input id="roofOverBack" type="number" min="0" step="1" placeholder="(blank = uniform)" /></label>
              </div>
              <div class="row">
                <label>Left<input id="roofOverLeft" type="number" min="0" step="1" placeholder="(blank = uniform)" /></label>
                <label>Right<input id="roofOverRight" type="number" min="0" step="1" placeholder="(blank = uniform)" /></label>
              </div>
            </fieldset>

            <fieldset>
              <legend>Instances</legend>

              <div class="row">
                <label>
                  Instance
                  <select id="instanceSelect"></select>
                </label>
                <div style="display:flex;gap:8px;justify-content:flex-end;align-items:end;">
                  <button id="saveInstanceBtn" type="button">Save</button>
                  <button id="loadInstanceBtn" type="button">Load</button>
                </div>
              </div>

              <div class="row">
                <label>
                  New name
                  <input id="instanceNameInput" type="text" placeholder="e.g. Client A" />
                </label>
                <div style="display:flex;gap:8px;justify-content:flex-end;align-items:end;">
                  <button id="saveAsInstanceBtn" type="button">Save As</button>
                  <button id="deleteInstanceBtn" type="button">Delete</button>
                </div>
              </div>

              <p id="instancesHint" class="hint"></p>
            </fieldset>
          </form>
        </div>
      </details>
    </aside>
  </div>

  <!-- View: Base Cutting List -->
  <div id="bomPage" class="page" aria-hidden="true">
    <h2 tabindex="-1">Master Cutting &amp; Assembly Schedule</h2>

    <div id="bomToolbar">
      <label for="unitsSelect" style="font-size:12px;color:#555;">Units:</label>
      <select id="unitsSelect">
        <option value="mm">mm</option>
        <option value="both">mm + in</option>
      </select>
      <button id="exportCsvBtn">Export CSV</button>
      <button id="printBtn">Print</button>
    </div>

    <div class="schedule-section">
      <h4>1. Timber Frame</h4>
      <table class="sticky-table">
        <thead><tr><th>Item</th><th>Qty</th><th>Cut Size</th><th>Notes</th></tr></thead>
        <tbody id="timberTableBody"></tbody>
        <tfoot><tr class="totals-row"><td colspan="4" id="timberTotals"></td></tr></tfoot>
      </table>
    </div>

    <div class="schedule-section">
      <h4>3. OSB Decking Cutting List (8x4 Sheets)</h4>
      <p class="subtle">Standard Sheets are full 1220×2440 (oriented per joists). Remainders are staggered as in the 3D layout.</p>

      <table class="sticky-table">
        <thead><tr><th colspan="4">Standard Sheets</th></tr></thead>
        <thead><tr><th>Piece</th><th>Qty</th><th>Size (L × W)</th><th>Notes</th></tr></thead>
        <tbody id="osbStdBody"></tbody>
        <tfoot><tr class="totals-row"><td colspan="4" id="osbStdTotals"></td></tr></tfoot>
      </table>

      <table class="sticky-table">
        <thead><tr><th colspan="4">Rip / Trim Cuts</th></tr></thead>
        <thead><tr><th>Piece</th><th>Qty</th><th>Size (L × W)</th><th>Notes</th></tr></thead>
        <tbody id="osbRipBody"></tbody>
        <tfoot><tr class="totals-row"><td colspan="4" id="osbRipTotals"></td></tr></tfoot>
      </table>

      <p id="osbSummary" class="subtle"></p>
    </div>

    <div class="schedule-section">
      <h4>PIR Insulation — Rip Cuts Only</h4>
      <table id="pirRipTable">
        <thead><tr><th>Piece Ref</th><th>Qty</th><th>Cut Size (L x W)</th><th>Type</th></tr></thead>
        <tbody id="pirRipBody"></tbody>
      </table>
      <p id="pirSummary" class="subtle"></p>
    </div>

    <div class="schedule-section">
      <h4>3. Plastic Grid Tiles (Modules)</h4>
      <table id="gridTable">
        <thead><tr><th>Piece Ref</th><th>Qty</th><th>Cut Size (L x W)</th><th>Type</th></tr></thead>
        <tbody id="gridBody"></tbody>
      </table>
    </div>
  </div>

  <!-- View: Walls Cutting List -->
  <div id="wallsBomPage" class="page" aria-hidden="true">
    <h2 tabindex="-1">Walls Cutting List</h2>
    <div class="schedule-section">
      <h4>Walls — Items</h4>
      <table class="sticky-table">
        <thead>
          <tr>
            <th>Item</th>
            <th>Qty</th>
            <th>L (mm)</th>
            <th>W (mm)</th>
            <th>D (mm)</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody id="bomTable"></tbody>
      </table>
    </div>
  </div>

  <div id="roofBomPage" class="page" aria-hidden="true">
    <h2 tabindex="-1">Roof Cutting List</h2>
    <div class="schedule-section">
      <h4>Roof — Items</h4>
      <table class="sticky-table">
        <thead>
          <tr>
            <th>Item</th><th>Qty</th><th>L (mm)</th><th>W (mm)</th><th>Notes</th>
          </tr>
        </thead>
        <tbody id="roofBomTable">
          <tr><td colspan="5">Roof cutting list not yet generated.</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script type="module" src="./src/index.js"></script>
  <script type="module">
    import { initViews } from './src/views.js';
    initViews();
  </script>
</body>
</html>
